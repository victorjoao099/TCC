<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Governamental - Sistema de Denúncias</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5; /* Cor de fundo suave */
        }
        /* Estilos para o scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #e2e8f0;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #94a3b8;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center py-8 px-4 sm:px-6 lg:px-8">
    <div class="max-w-4xl w-full bg-white shadow-lg rounded-lg p-6 sm:p-8 space-y-8">
        <header class="text-center">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-800 mb-2">Dashboard Governamental</h1>
            <p class="text-gray-600 text-lg">Visão geral e exportação de dados das denúncias de infraestrutura.</p>
            <nav class="mt-4">
                <a href="index.html" class="inline-block bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md shadow-md transition duration-300 ease-in-out">
                    Voltar para o Sistema de Denúncias
                </a>
            </nav>
        </header>

        <section class="bg-purple-50 p-6 rounded-lg shadow-md">
            <h2 class="text-2xl font-semibold text-purple-700 mb-4">Resumo das Denúncias</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div class="bg-purple-100 p-4 rounded-md shadow-sm text-center">
                    <p class="text-gray-600 text-sm">Total de Denúncias</p>
                    <p id="totalDenuncias" class="text-2xl font-bold text-purple-800">0</p>
                </div>
                <div class="bg-purple-100 p-4 rounded-md shadow-sm text-center">
                    <p class="text-gray-600 text-sm">Denúncias Pendentes</p>
                    <p id="denunciasPendentes" class="text-2xl font-bold text-red-600">0</p>
                </div>
                <div class="bg-purple-100 p-4 rounded-md shadow-sm text-center">
                    <p class="text-gray-600 text-sm">Denúncias Resolvidas</p>
                    <p id="denunciasResolvidas" class="text-2xl font-bold text-green-600">0</p>
                </div>
            </div>
            <div class="mb-6">
                <h3 class="text-lg font-semibold text-purple-700 mb-2">Denúncias por Categoria:</h3>
                <ul id="denunciasPorCategoria" class="list-disc list-inside text-gray-700">
                    </ul>
            </div>
            <button id="exportarDadosBtn" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-md shadow-md transition duration-300 ease-in-out transform hover:scale-105">
                Exportar Dados (CSV)
            </button>
        </section>
    </div>

    <div id="messageModal" class="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50 hidden">
        <div class="bg-white p-8 rounded-lg shadow-xl max-w-sm w-full text-center">
            <h3 id="modalTitle" class="text-xl font-semibold mb-4 text-gray-800"></h3>
            <p id="modalMessage" class="text-gray-600 mb-6"></p>
            <button id="closeModalBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-5 rounded-md transition duration-300 ease-in-out">
                OK
            </button>
        </div>
    </div>
    
    <script>
        // Chave para localStorage
        const LOCAL_STORAGE_KEY = 'denunciasInfraUrbana';

        // Array para armazenar as denúncias (carregado do localStorage)
        let denuncias = JSON.parse(localStorage.getItem(LOCAL_STORAGE_KEY)) || [];

        // Referências para elementos do Dashboard e Modal
        const totalDenuncias = document.getElementById('totalDenuncias');
        const denunciasPendentes = document.getElementById('denunciasPendentes');
        const denunciasResolvidas = document.getElementById('denunciasResolvidas');
        const denunciasPorCategoria = document.getElementById('denunciasPorCategoria');
        const exportarDadosBtn = document.getElementById('exportarDadosBtn');
        const messageModal = document.getElementById('messageModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalMessage = document.getElementById('modalMessage');
        const closeModalBtn = document.getElementById('closeModalBtn');

        // Função para exibir o modal de mensagem
        function showMessageModal(title, message) {
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            messageModal.classList.remove('hidden');
        }

        // Event listener para fechar o modal
        closeModalBtn.addEventListener('click', () => {
            messageModal.classList.add('hidden');
        });

        // --- Funções do Dashboard ---
        function updateDashboard() {
            totalDenuncias.textContent = denuncias.length;

            const pendentes = denuncias.filter(d => d.status === 'Pendente').length;
            const resolvidas = denuncias.filter(d => d.status === 'Resolvido').length;
            denunciasPendentes.textContent = pendentes;
            denunciasResolvidas.textContent = resolvidas;

            const categoriasCount = {};
            denuncias.forEach(d => {
                categoriasCount[d.categoria] = (categoriasCount[d.categoria] || 0) + 1;
            });

            denunciasPorCategoria.innerHTML = '';
            for (const categoria in categoriasCount) {
                const li = document.createElement('li');
                li.textContent = `${categoria}: ${categoriasCount[categoria]}`;
                denunciasPorCategoria.appendChild(li);
            }

            if (Object.keys(categoriasCount).length === 0) {
                const li = document.createElement('li');
                li.textContent = 'Nenhuma denúncia por categoria.';
                denunciasPorCategoria.appendChild(li);
            }
        }

        // Função para exportar dados para CSV
        function exportToCSV() {
            if (denuncias.length === 0) {
                showMessageModal('Erro', 'Não há dados para exportar.');
                return;
            }

            const headers = ["ID", "Descrição", "Categoria", "Localização", "Latitude", "Longitude", "Data", "Status"];
            let csv = headers.join(";") + "\n"; // Cabeçalho CSV

            denuncias.forEach(denuncia => {
                const row = [
                    denuncia.id,
                    `"${denuncia.descricao.replace(/"/g, '""')}"`, // Escapa aspas duplas
                    denuncia.categoria,
                    `"${denuncia.localizacao.replace(/"/g, '""')}"`,
                    denuncia.latitude,
                    denuncia.longitude,
                    new Date(denuncia.data).toLocaleString(),
                    denuncia.status
                ];
                csv += row.join(";") + "\n";
            });

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            if (link.download !== undefined) { // Verifica se o navegador suporta o atributo download
                const url = URL.createObjectURL(blob);
                link.setAttribute("href", url);
                link.setAttribute("download", "denuncias_infraestrutura.csv");
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                showMessageModal('Exportação Concluída', 'Dados exportados com sucesso para "denuncias_infraestrutura.csv"!');
            } else {
                showMessageModal('Erro', 'Seu navegador não suporta a exportação direta de arquivos.');
            }
        }

        exportarDadosBtn.addEventListener('click', exportToCSV);
        // --- Fim das Funções do Dashboard ---

        // Inicializa o dashboard quando a página é carregada
        document.addEventListener('DOMContentLoaded', () => {
            updateDashboard(); // Atualiza o dashboard na carga inicial
        });
    </script>
</body>
</html>
